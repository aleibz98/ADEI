---
title: "Primera Práctica de ADEI"
author: "Alejandro Alarcón"
date: "10/19/2021"
output: pdf_document
---

Configuración del environment
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require("knitr")
opts_knit$set(root.dir = "/Users/aleibz/ADEI/CarPrices/")
```

Limpiamos el environment.
```{r}
# Clear plots
if(!is.null(dev.list())) dev.off()

# Clean workspace
rm(list=ls())
```
Importamos las librerias y paquetes necesarios.
```{r}
options(contrasts=c("contr.treatment","contr.treatment"))

requiredPackages <- c("effects","FactoMineR","car", "factoextra","RColorBrewer","ggplot2","dplyr","ggmap","ggthemes","knitr")

package.check <- lapply(requiredPackages, FUN = function(x) {
  if (!require(x, character.only = TRUE)) {
    install.packages(x, dependencies = TRUE)
    library(x, character.only = TRUE)
  }
})
#verify they are loaded
search()
```

Cargamos los datos
```{r}
filepath<-"/Users/aleibz/ADEI/CarPrices/"
load(paste0(filepath,"MyOldCars-Raw.RData"))
```

Echamos un vistazo al dataset
```{r}
summary( df )
names( df )
```

## Transformación de variables categóricas a factores
```{r}
#Model
df$model <- factor(paste0(df$manufacturer, "-", df$model))
levels(df$model)

#Transmission
df$transmission <- factor( df$transmission )
levels( df$transmission )
df$transmission <- factor( df$transmission, levels = c("Manual","Semi-Auto","Automatic"),labels = paste0("f.Trans-",c("Manual","SemiAuto","Automatic")))
head( df )

#FuelType
df$fuelType <- factor(df$fuelType)
levels(df$fuelType)
df$fuelType <- factor( df$fuelType, levels = c("Diesel","Petrol","Hybrid"), labels = paste0("f.Fuel-",c("Diesel","Petrol","Hybrid")))

#Manufacturer
df$manufacturer <- factor(df$manufacturer)
```

## Transformación de variables numéricas a factores
```{r}
#Year + Age
summary(df$year)
df$age <-  2021 - df$year 
df$year<-factor(df$year)
summary(df$age)

#EngineSize
summary(df$engineSize)
df$engineSize_factor <- factor( df$engineSize)
summary( df$engineSize_factor)
```

## Explorar variables con summary y plots
```{r}
plot( df$year )
boxplot( df$age )
plot( df$engineSize_factor )
plot( df$fuelType )
plot( df$transmission )
plot( df$fuelType )
```

Funciones útiles
```{r}
calcQ <- function(x) {
  s.x <- summary(x)
  iqr<-s.x[5]-s.x[2]
  list(souti=s.x[2]-3*iqr, mouti=s.x[2]-1.5*iqr, min=s.x[1], q1=s.x[2], q2=s.x[3], 
       q3=s.x[5], max=s.x[6], mouts=s.x[5]+1.5*iqr, souts=s.x[5]+3*iqr ) }

countNA <- function(x) {
  mis_x <- NULL
  for (j in 1:ncol(x)) {mis_x[j] <- sum(is.na(x[,j])) }
  mis_x <- as.data.frame(mis_x)
  rownames(mis_x) <- names(x)
  mis_i <- rep(0,nrow(x))
  for (j in 1:ncol(x)) {mis_i <- mis_i + as.numeric(is.na(x[,j])) }
  list(mis_col=mis_x,mis_ind=mis_i) }

countX <- function(x,X) {
  n_x <- NULL
  for (j in 1:ncol(x)) {n_x[j] <- sum(x[,j]==X) }
  n_x <- as.data.frame(n_x)
  rownames(n_x) <- names(x)
  nx_i <- rep(0,nrow(x))
  for (j in 1:ncol(x)) {nx_i <- nx_i + as.numeric(x[,j]==X) }
  list(nx_col=n_x,nx_ind=nx_i) }
```

# Por cada variables
## Conteo de missings
```{r}
imis<-rep(0,nrow(df))  # rows - trips
jmis<-rep(0,2*ncol(df))  # columns - variables

mis1<-countNA(df)
imis<-mis1$mis_ind
imis
mis1$mis_col # Number of missings for the current set of variables

# Prueba
```

## Conteo de errores
```{r}
iouts<-rep(0,nrow(df))  # rows - trips
jouts<-rep(0,2*ncol(df))  # columns - variables


```

## Conteo de outliers (función que reciba la variable como parámetro)
```{r}

```

Aplicar las funciones anteriores a los todas las variables
```{r}

```

#Por cada individuo
## Conteo de missings (función que reciba el individuo como parámetro)
```{r}

```

## Conteo de errores (función que reciba el individuo como parámetro)
```{r}

```

## Conteo de outliers (función que reciba el individuo como parámetro)
```{r}

```

Aplicar las funciones anteriores a los individuos
```{r}

```

## Identificar los outliers multivariantes
```{r}
# Esto tengo que mirar como se hacia
```

# Relaciones entre variables
## Correlaciones
```{r}
# No se que quiere decir exactamente... Pensaba que esto venía por el profiling...
```

## Texto que no sé que quiere decir
```{r}

```

# Imputación
## Variables numéricas
```{r}

```

## Factores
```{r}

```

# Discretización de variables numéricas en factores (por cuantiles)
-- Esto se tendría que hacer más tarde, cuando ya se haya hecho todo lo de los plots y la imputación --
```{r}

```

# Profiling
En esta parte es donde empieza a entrar todo lo de quali y quanti

## Target numérico (Price)
```{r}

```

## Target factor (AUDI)
```{r}

```



